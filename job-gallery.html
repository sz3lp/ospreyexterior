<section id="job-gallery" class="job-gallery" data-source="./jobs/index.json">
  <div class="job-gallery__header">
    <h2>Recent Projects</h2>
    <p>Browse documented jobs powered by the automated image pipeline.</p>
  </div>
  <div class="job-gallery__grid" id="job-gallery-grid"></div>
</section>

<style>
  .job-gallery { padding: 1.5rem; background: #f7fafc; }
  .job-gallery__grid { display: grid; gap: 1rem; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); }
  .job-card { background: #fff; border: 1px solid #e2e8f0; border-radius: 8px; overflow: hidden; box-shadow: 0 1px 2px rgba(0,0,0,0.05); display: flex; flex-direction: column; }
  .job-card img { width: 100%; height: 180px; object-fit: cover; display: block; }
  .job-card__body { padding: 0.75rem 0.9rem; display: flex; flex-direction: column; gap: 0.35rem; }
  .job-card__meta { font-size: 0.9rem; color: #4a5568; display: flex; justify-content: space-between; }
  .badge { display: inline-flex; align-items: center; gap: 0.25rem; padding: 0.2rem 0.5rem; border-radius: 999px; background: #edf2f7; color: #2d3748; font-size: 0.85rem; }
  .badge--after { background: #c6f6d5; color: #22543d; }
</style>

<script>
  (async () => {
    const container = document.getElementById('job-gallery-grid');
    const source = document.getElementById('job-gallery').dataset.source;
    try {
      const response = await fetch(source, { cache: 'no-cache' });
      const jobs = await response.json();
      jobs.forEach((job) => {
        const card = document.createElement('article');
        card.className = 'job-card';
        const img = document.createElement('img');
        img.loading = 'lazy';
        img.src = job.thumb;
        img.alt = `${job.service} in ${job.city} completed on ${job.date}`;
        const body = document.createElement('div');
        body.className = 'job-card__body';
        const title = document.createElement('h3');
        title.textContent = `${job.service} â€“ ${job.city}`;
        const meta = document.createElement('div');
        meta.className = 'job-card__meta';
        const dateSpan = document.createElement('span');
        dateSpan.textContent = job.date;
        const badge = document.createElement('span');
        badge.className = 'badge badge--after';
        badge.textContent = 'After';
        meta.append(dateSpan, badge);
        const link = document.createElement('a');
        link.href = `${window.location.origin}/jobs/${job.city.toLowerCase().replace(/\s+/g, '-')}/${job.service.toLowerCase().replace(/\s+/g, '-')}/${job.jobID}.json`;
        link.textContent = 'Open JSON';
        link.rel = 'nofollow';
        body.append(title, meta, link);
        card.append(img, body);
        container.append(card);
      });
    } catch (error) {
      container.innerHTML = '<p>Unable to load gallery data.</p>';
      console.error('Gallery load failed', error);
    }
  })();
</script>
